<%- include(versionCheckTemplate, { version: '1.0.0'}) %>
let cc;
let rootURL = '';
let prefixServer = '';
let autoLoadEmoji = false;
let cullingFireworks = false;
let rabbitJumpToRibben = false;
let replaceFirework = false;
export class Application {
    constructor () {
        this.settingsPath = rootURL + '<%= settingsJsonPath %>';
        this.showFPS = <%= showFPS %>;
    }
    
    init (engine) {
        cc = engine;
        cc.game.onPostBaseInitDelegate.add(this.onPostInitBase.bind(this));
        cc.game.onPostSubsystemInitDelegate.add(this.onPostSystemInit.bind(this));
    }

    onPostInitBase () {
        // cc.settings.overrideSettings('assets', 'server', '');
        // do custom logic
    }

    onPostSystemInit () {
        // do custom logic
    }

    start () {
        return cc.game.init({
            debugMode: <%= debugMode %> ? cc.DebugMode.INFO : cc.DebugMode.ERROR,
            settingsPath: this.settingsPath,
            overrideSettings: {
                // assets: {
                //      preloadBundles: [{ bundle: 'main', version: 'xxx' }],
                // }
                profiling: {
                    showFPS: this.showFPS,
                },
                custom: {
                    rootURL: rootURL,
                    prefixServer: prefixServer,
                    autoLoadEmoji: autoLoadEmoji,
                    cullingFireworks: cullingFireworks,
                    rabbitJumpToRibben: rabbitJumpToRibben,
                    replaceFirework: replaceFirework,
                },
                screen: {
                    overrideDpr: this.overrideDpr,
                }
            }
        }).then(
            () => {
                cc.game.run()
            }
        );
    }
}